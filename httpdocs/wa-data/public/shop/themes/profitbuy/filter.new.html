{strip}

{$feature_button = $theme_settings.feature_button|default:""}
{$filters_expand = $theme_settings.default_filters_expand|default:""}

{*$feature_button = 'touch_screen,manufacturer'*}
{*$filters_expand = 'price,touch_screen'*}

{$filters_expand = $filters_expand|cat:waRequest::cookie('shop_filters_expand', '', waRequest::TYPE_STRING)}

{* filtering by product features *}
{if waRequest::isXMLHttpRequest() && waRequest::get('page', 1) == 1}
<link href="{$wa_static_url}wa-content/css/jquery-ui/base/jquery.ui.slider.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="{$wa_static_url}wa-content/js/jquery-ui/jquery.ui.core.min.js?v{$wa->version(true)}"></script>
<script type="text/javascript" src="{$wa_static_url}wa-content/js/jquery-ui/jquery.ui.widget.min.js?v{$wa->version(true)}"></script>
<script type="text/javascript" src="{$wa_static_url}wa-content/js/jquery-ui/jquery.ui.mouse.min.js?v{$wa->version(true)}"></script>
<script type="text/javascript" src="{$wa_static_url}wa-content/js/jquery-ui/jquery.ui.slider.min.js?v{$wa->version(true)}"></script>
{/if}
<div class="filters sidebar-box{if !empty($theme_settings.ajax_filters)} ajax{/if}">
    {* <form method="get" action="{$wa->currentUrl(0,1)}" data-loading="{$wa_parent_theme_url}img/loading16.gif"  data-title="[`Filter`]: " > *}
        <div class="row-grid row-filter als-top">
            <div class="col-grid s12 m12 l12 top-row al-block block1 art-al-block">
            {foreach $filters as $fid => $filter}
                {if $filter@first}

                    <div class="col-grid s12 m12 l12 top-line art-top-line">
                        <div class="col-grid s12 m2 l2"><span class="art-style-bum">1.</span> Выберите тип:</div>
                        <div class="col-grid s12 m9 l8 features-row-inline">
                             {foreach $filter.values as $v_id => $v}
                                <div class="row-item-features">
                                    <label class="{if strpos($feature_button, $filter.code) !== false}label at-stylize-label{/if}">
                                        <input{if strpos($feature_button, $filter.code) !== false} class="at-stylize-input"{/if} type="checkbox" name="{$filter.code}[]" checked value="{$v_id}" style='display: none;'>
                                        {if strpos($feature_button, $filter.code) !== false}
                                            {if $filter.type == 'color'}
                                                <span class="at-stylize-color" style="{$v->style}" title="{strip_tags($v)}"></span>
                                            {else}
                                                <span class="at-stylize-button">{$v}</span>
                                            {/if}
                                        {else}
                                            {$v}
                                            <span class="fiwex-feat-val" data-feat_val_id="{$v_id}" data-fiwex-parent_id="{$filter.id}"></span>
                                        {/if}
                                    </label>
                                </div>
                            {/foreach}
                        </div>

                        <div class="col-grid s12 m1 l2 art-reset-features">
                            <a href="#" id="reset-features-top">Сбросить</a>
                        </div>
                    </div>

                    <div style="clear:both"></div>

                    <hr class="art-hr-filter-brand">

                {else}

                    {if $filter@iteration > 1}<div class="art-block2 col-grid m12 l12">{/if}

                        <div class="col-grid s6 m3 l3 al-block block2 art-for-first-coll">
                            <div class="art-wrap-harki art-for-first-coll">
                                <span class="feature-name-item art-feature-name-item">
                                  <span class="art-style-bum">2. </span>Выберите коллекцию
                                </span>
                                <br>
                                <div class="overflow-min filter-wrapper">
                                    <label class="">
                                        <select id="id-collection-select" class="s-select art-s-select" size="" name="">
                                            <option class="stylize" name="" value="">Все коллекции</option>
                                            {foreach $category as $subcategory}
                                                <option class="stylize opt" name="{$subcategory.name}" value="{$subcategory.id}">{$subcategory.name}</option>
                                            {/foreach}
                                        </select>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="col-grid s6 m3 l3 al-block block2">
                            <div class="art-wrap-harki">
                                <span class="feature-name-item art-feature-name-item">
                                  <span class="art-style-bum">3. </span>Выберите отделку
                                </span>
                                <br>
                                <div class="overflow-min filter-wrapper">
                                    <label class="">
                                        <select id="id-select-decoration" class="s-select art-s-select" size="" name="" disabled="disabled">
                                            <option class="stylize" name="" value="">Все отделки</option>
                                            {foreach $category as $subcategory}
                                                {if count($subcategory.childs)>0}
                                                {foreach $subcategory.childs as $subcategoryChilds}
                                                    <option style="display: none;" class="stylize opt" name="{$subcategoryChilds.name}" data-id-collection="{$subcategory.id}" value="{$subcategoryChilds.id}">{$subcategoryChilds.name}</option>
                                                {/foreach}
                                                {/if}
                                            {/foreach}
                                        </select>
                                    </label>
                                </div>
                            </div>
                        </div>

                        {if $fid == 'price'}
                        <div class="col-grid {*s16 m4*} m3 l3 al-block block2 col-diapason-cen new-col-block">
                            <div class="overflow-min ceny">
                                <div class="art-wrap-harki">
                                    <span class="feature-name-item art-feature-name-item"><span class="art-style-bum">4. </span>Определите цену</span>
                                    <div class="als-price-wrapp">
                                        {if $filter.max > 100000}{$filter.max = $filter.max + 5}{/if}
                                        <div class="filter-slider-wrapper">
                                            <input type="text" class="min" name="price_min" {if $wa->get('price_min')}value="{(int)$wa->get('price_min')}"{/if} placeholder="{floor($filter.min)}">
                                            <input type="text" class="max" name="price_max" {if $wa->get('price_max')}value="{(int)$wa->get('price_max')}"{/if} placeholder="{ceil($filter.max)}">
                                        </div>

                                        <div class="prices-text art-prices-text">
                                            <span class="als-min art-als-min">от <input type="text" class="min-value art-min-value" value="{floor($filter.min)}" placeholder="{floor($filter.min)}"> р.</span>
                                            <span class="als-max art-als-max">до <input type="text" class="max-value art-max-value" value="{ceil($filter.max)}" placeholder="{ceil($filter.max)}"> р.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {else}
                        <div class="col-grid s6 m3 l3 al-block block2">

                        </div>
                        {/if}


                    {if $filter@last}
                        <div class="col-grid {*s6 m2*}m3 l3 buttons-block new-col-block">
                            <div class="art-prim-sbros">

                            <a id="btn-filter-use" type="button" name="button" class="button">применить</a><br>
                            <div>
                                <a id="clear-filters-expand" class="button">Сбросить</a>
                            </div>

                          </div>
                        </div>
                    </div>
                    {/if}

                {/if}
            {/foreach}
            </div>
            {*literal}
            <script>

                $(document).ready(function() {
                    var typeArray = [],
                        collection,
                        decoration,
                        mainMinPrice = $('.filter-slider-wrapper .min').attr('placeholder'),
                        mainMaxPrice = $('.filter-slider-wrapper .max').attr('placeholder');

                        // Собираем массив типов
                        $('.features-row-inline input').each(function() {
                            if ($(this).is(':checked')) { typeArray.push(parseInt($(this).val())); };
                        });

                        // Собираем массив типов, конец

                        // Проставляем минимальную и максимальную цены на коллекции и отделки
                        $('.line-collection.t2').each(function() {
                            var c = $(this);
                            var dec = c.children('.t4');
                            var cMinPrice = mainMaxPrice;
                            var cMaxPrice = mainMinPrice;
                            dec.each(function() {
                                var d = $(this);
                                var li = d.children('li');
                                var dataMin = d.data('min-price');
                                var dataMax = d.data('max-price');
                                var dMinPrice = mainMaxPrice;
                                var dMaxPrice = mainMinPrice;
                                li.each(function() {
                                    var item = $(this);
                                    var price = item.data('price');
                                    if (price < dMinPrice) { dMinPrice = price; };
                                    if (price > dMaxPrice) { dMaxPrice = price; };
                                }).parent()
                                  .attr('data-min-price',dMinPrice)
                                  .attr('data-max-price',dMaxPrice);
                                  if (cMinPrice > dMinPrice) { cMinPrice = dMinPrice };
                                  if (cMaxPrice < dMaxPrice) { cMaxPrice = dMaxPrice; };
                            }).parent()
                              .attr('data-min-price',cMinPrice)
                              .attr('data-max-price',cMaxPrice);
                        });

                        // Проверка выбора коллекции
                        if ($('#id-collection-select').val() != '') {
                            collection = $('#id-collection-select').val();
                            var d = $('#id-select-decoration');
                            d.children('option.opt').each(function() {
                                var o = $(this);
                                var oC = $(this).data('id-collection');
                                if (oC == collection) {
                                    o.show();
                                } else {
                                    o.hide();
                                };
                            }).parent().removeAttr('disabled');
                            if ($('#id-select-decoration').val() == '') {
                                var inputMin = $('.filter-slider-wrapper .min');
                                var inputMax = $('.filter-slider-wrapper .max');
                                var colMinPrice = $('.line-collection.t2[data-title-collection="'+collection+'"]').data('min-price');
                                var colMaxPrice = $('.line-collection.t2[data-title-collection="'+collection+'"]').data('max-price');
                                inputMin.val(colMinPrice).trigger('change');
                                inputMax.val(colMaxPrice).trigger('change');
                            };
                        };
                        // Проверка выбора коллекции, конец

                        // Проверка выбора отделки
                        if ($('#id-select-decoration').val() != '') {
                            decoration = $('#id-select-decoration').val();

                            var inputMin = $('.filter-slider-wrapper .min');
                            var inputMax = $('.filter-slider-wrapper .max');
                            var decMinPrice = $('.line-collection.t4[data-title-decoration="'+decoration+'"]').data('min-price');
                            var decMaxPrice = $('.line-collection.t4[data-title-decoration="'+decoration+'"]').data('max-price');
                            inputMin.val(decMinPrice).trigger('change');
                            inputMax.val(decMaxPrice).trigger('change');
                        };
                        // Проверка выбора отделки, конец


                        // Применить фильтр
                        $('.filters').on('click', '#btn-filter-use', function(event) {
                            event.preventDefault();
                            if (typeArray == '') {
                                var typeLine = $('.art-top-line');
                                typeLine.addClass('needChange');
                                $('.row-item-features').on('change', 'input', function(event) { typeLine.removeClass('needChange'); });
                                setTimeout(function() { typeLine.removeClass('needChange'); }, 3000);
                                return false;
                            } else {
                                var minPrice = $('.prices-text input.min-value').val();
                                var maxPrice = $('.prices-text input.max-value').val();
                                // Сортировка коллекции и отделки
                                if (collection && decoration) {
                                    // Скрываем категории и отделки
                                    $('.line-collection.t2').each(function() {
                                        var c = $(this);
                                        var dC = c.data('title-collection');
                                        if (dC == collection) {
                                            c.children('.line-collection').each(function() {
                                                var d = $(this);
                                                var dD = d.data('title-decoration');
                                                if (dD == decoration) {
                                                    d.children('li').each(function() {
                                                        var li = $(this);
                                                        var type = li.data('type-id');
                                                        var price = li.data('price');
                                                        if ($.inArray(type, typeArray) !== -1 &&
                                                            price >= minPrice &&
                                                            price <= maxPrice)
                                                        {
                                                            li.show();
                                                        } else {
                                                            li.hide();
                                                        };
                                                    }).parent().show();
                                                } else {
                                                    d.hide();
                                                };
                                            }).parent().show();
                                        } else {
                                            c.hide();
                                        }
                                    });
                                } else if (collection && !decoration) {
                                    $('.line-collection.t2').each(function() {
                                        var c = $(this);
                                        var dC = c.data('title-collection');
                                        if (dC == collection) {
                                            c.children('.line-collection').each(function() {
                                                var d = $(this);
                                                d.show().children('li').each(function() {
                                                    var li = $(this);
                                                    var type = li.data('type-id');
                                                    var price = li.data('price');
                                                    if ($.inArray(type, typeArray) !== -1 &&
                                                        price >= minPrice &&
                                                        price <= maxPrice)
                                                    {
                                                        li.show().parent().addClass('active');
                                                    } else {
                                                        li.hide();
                                                    };
                                                }).parent().each(function() {
                                                    if (!d.hasClass('active')) {
                                                        d.hide();
                                                    } else {
                                                        d.removeClass('active').show();
                                                    }
                                                });
                                            }).parent().show();
                                        } else {
                                            c.hide();
                                        };
                                    });
                                } else {
                                    $('.line-collection.t2').each(function() {
                                        var c = $(this);
                                        var dC = c.data('title-collection');
                                        c.show().children('.line-collection').each(function() {
                                            var d = $(this);
                                            d.show().children('li').each(function() {
                                                var li = $(this);
                                                var type = li.data('type-id');
                                                var price = li.data('price');
                                                if ($.inArray(type, typeArray) !== -1 &&
                                                    price >= minPrice &&
                                                    price <= maxPrice)
                                                {
                                                    li.show().parent().addClass('active');
                                                } else {
                                                    li.hide();
                                                };
                                            }).parent().each(function() {
                                                if (!d.hasClass('active')) {
                                                    d.hide();
                                                } else {
                                                    d.show().removeClass('active').parent().addClass('active');
                                                }
                                            });
                                        }).parent().each(function() {
                                            if (!c.hasClass('active')) {
                                                c.hide();
                                            } else {
                                                c.show().removeClass('active');
                                            }
                                        });
                                    });
                                }
                            };
                        });
                        // Применить фильтр, конец


                        // Сбрасываем верхнюю часть фильтра
                        $('.filters').on('click', '#reset-features-top', function(event) {
                            event.preventDefault();
                            var f = $('.features-row-inline');
                            var item = f.children('.row-item-features');
                            item.each(function() {
                                var input = $(this).find('input.at-stylize-input');
                                var typeId = input.val();
                                if (input.is(':checked')) {
                                    input.trigger('click');
                                };
                            });
                        });
                        // Сбрасываем верхнюю часть фильтра, конец


                        // Сбрасываем нижнюю часть фильтра
                        $('.filters').on('click', '#clear-filters-expand', function(event) {
                            event.preventDefault();
                            if (collection) {
                                var c = $('#id-collection-select');
                                var cf = c.children('option:first');
                                cf.attr('selected', 'selected').trigger('change');
                            }

                            var minPlace = $('.filter-slider-wrapper .min').attr('placeholder');
                            var maxPlace = $('.filter-slider-wrapper .max').attr('placeholder');
                            $('.filter-slider-wrapper .min').val(minPlace).trigger('change').next().val(maxPlace).trigger('change');

                        });
                        // Сбрасываем нижнюю часть фильтра, конец

                        // Выбор типа
                        $('.features-row-inline').on('change', 'input.at-stylize-input', function(event) {
                            // Добавление/удаление типа
                            event.preventDefault();
                            var typeBox = $(this);
                            var typeId = parseInt(typeBox.val());
                            var cs = $('#id-collection-select');
                            var csId = cs.val();
                            var c = $('.line-collection.t2');

                            if ($(this).is(':checked')) {
                                if ($.inArray(typeId, typeArray) === -1) { typeArray.push(typeId); };

                                // Сортировка коллекции
                                c.each(function() {
                                    var col = $(this);
                                    var cID = col.data('title-collection');
                                    var li = col.find('li');
                                    li.each(function() {
                                        var item = $(this);
                                        var liType = item.data('type-id');
                                        if ($.inArray(liType, typeArray) !== -1) {
                                            cs.children('option[value="'+cID+'"]').show();
                                            return false;
                                        } else {
                                            cs.children('option[value="'+cID+'"]').hide();
                                        };
                                    });
                                    if (cs.children('option:selected').is(':hidden')) {
                                        cs.children('option:first').attr('selected', 'selected').trigger('change');
                                    }
                                });
                                // Сортировка коллекции, конец

                            } else {
                                var index = typeArray.indexOf(typeId);
                                if (index > -1) { typeArray.splice(index, 1); };

                                // Сортировка коллекции
                                c.each(function() {
                                    var col = $(this);
                                    var cID = col.data('title-collection');
                                    var li = col.find('li');
                                    li.each(function() {
                                        var item = $(this);
                                        var liType = item.data('type-id');
                                        if ($.inArray(liType, typeArray) !== -1) {
                                            cs.children('option[value="'+cID+'"]').show();
                                            return false;
                                        } else {
                                            cs.children('option[value="'+cID+'"]').hide();
                                        };
                                    });
                                    if (cs.children('option:selected').is(':hidden')) {
                                        cs.children('option:first').attr('selected', 'selected').trigger('change');
                                    }
                                });
                                // Сортировка коллекции, конец

                            };
                            // Добавление/удаление типа, конец

                            var ds = $('#id-select-decoration');
                            var dsId = ds.val();

                            // Сортировка отделки
                            if (csId !== '') {
                                var curCol = $('.line-collection.t2[data-title-collection="'+csId+'"]');
                                var d = curCol.children('.t4');
                                d.each(function() {
                                    var decor = $(this);
                                    var dID = decor.data('title-decoration');
                                    var li = decor.find('li');
                                    li.each(function() {
                                        var item = $(this);
                                        var liType = item.data('type-id');
                                        if ($.inArray(liType, typeArray) !== -1) {
                                            ds.children('option[value="'+dID+'"]').show();
                                            return false;
                                        } else {
                                            ds.children('option[value="'+dID+'"]').hide();
                                        };
                                    });
                                    if (ds.children('option:selected').is(':hidden')) {
                                        ds.children('option:first').attr('selected', 'selected').trigger('change');
                                    }
                                });
                            }
                            // Сортировка отделки, конец

                            if (typeArray == '') {
                                cs.attr('disabled', 'disabled');
                            } else {
                                cs.removeAttr('disabled');
                            }
                        });
                        // Выбор типа, конец


                        // Выбираем коллекцию
                        $('.filters').on('change', '#id-collection-select', function(event) {

                            var c = $(this);
                            collection = c.val();
                            var d = $('#id-select-decoration');

                            if (collection != '') {
                                d.children('option.opt').each(function() {
                                    var o = $(this);
                                    var oC = $(this).data('id-collection');
                                    if (oC == collection) {
                                        o.show();

                                        // Сортировка отделки
                                        var ds = $('#id-select-decoration');
                                        var dsId = ds.val();
                                        var curCol = $('.line-collection.t2[data-title-collection="'+collection+'"]');
                                        var d = curCol.children('.t4');
                                        d.each(function() {
                                            var decor = $(this);
                                            var dID = decor.data('title-decoration');
                                            var li = decor.find('li');
                                            li.each(function() {
                                                var item = $(this);
                                                var liType = item.data('type-id');
                                                if ($.inArray(liType, typeArray) !== -1) {
                                                    ds.children('option[value="'+dID+'"]').show();
                                                    return false;
                                                } else {
                                                    ds.children('option[value="'+dID+'"]').hide();
                                                };
                                            });
                                            if (ds.children('option:selected').is(':hidden')) {
                                                ds.children('option:first').attr('selected', 'selected').trigger('change');
                                            }
                                        });
                                        // Сортировка отделки, конец

                                    } else {
                                        o.hide();
                                    };
                                }).parent().removeAttr('disabled');
                                var inputMin = $('.filter-slider-wrapper .min');
                                var inputMax = $('.filter-slider-wrapper .max');
                                var colMinPrice = $('.line-collection.t2[data-title-collection="'+collection+'"]').data('min-price');
                                var colMaxPrice = $('.line-collection.t2[data-title-collection="'+collection+'"]').data('max-price');
                                inputMin.val(colMinPrice).trigger('change');
                                inputMax.val(colMaxPrice).trigger('change');
                            } else {
                                d.children('option:first').prop('selected', 'selected').parent().attr('disabled','disabled');
                            };
                            decoration = '';
                        });
                        // Выбираем коллекцию, конец


                        // Выбираем отделку
                        $('.filters').on('change', '#id-select-decoration', function(event) {
                            var d = $(this);
                            decoration = d.val();

                            var inputMin = $('.filter-slider-wrapper .min');
                            var inputMax = $('.filter-slider-wrapper .max');
                            var decMinPrice = $('.line-collection.t4[data-title-decoration="'+decoration+'"]').data('min-price');
                            var decMaxPrice = $('.line-collection.t4[data-title-decoration="'+decoration+'"]').data('max-price');
                            inputMin.val(decMinPrice).trigger('change');
                            inputMax.val(decMaxPrice).trigger('change');
                        });
                        // Выбираем отделку, конец

                        //Ввод цены
                        $('.filter-slider a').first().addClass('min-slider').next().addClass('max-slider');
                        $('.filter-slider a').bind('click keyup', function(event) {
                            var that = $(this);
                            var valMin = $('input.min-value').val();
                            var valMax = $('input.max-value').val();

                            // if (collection && decoration) {
                            //     var products = $('.line-collection.t4[data-title-decoration="'+decoration+'"]');
                            //     var decMin = products.data('min-price');
                            //     var decMax = products.data('max-price');
                            //     var i = 0;
                            //     products.children('li').each(function() {
                            //         var li = $(this);
                            //         var liType = li.data('type-id');
                            //         var price = li.data('price');
                            //         if ($.inArray(liType, typeArray) !== -1 &&
                            //             price > valMin &&
                            //             price < valMax ) {
                            //             i++;
                            //             if (i == 1) { return false };
                            //         };
                            //     });
                            //     if (i == 0) {
                            //         if ($(this).hasClass('min-slider')) {
                            //             $('input.min-value').val(decMin).trigger('change');
                            //         } else if ($(this).hasClass('max-slider')){
                            //             $('input.max-value').val(decMax).trigger('change');
                            //         }
                            //         if (!$('.slider-hint').length) {
                            //             $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                            //             setTimeout(function() {
                            //                 $('.slider-hint').fadeOut(500).remove();
                            //             }, 3000);
                            //         };
                            //     };
                            // } else if (collection) {
                            //     var products = $('.line-collection.t2[data-title-collection="'+collection+'"]');
                            //     var decMin = products.data('min-price');
                            //     var decMax = products.data('max-price');
                            //     var items = products.find('li');
                            //     var i = 0;
                            //     items.each(function() {
                            //         var li = $(this);
                            //         var liType = li.data('type-id');
                            //         var price = li.data('price');
                            //         if ($.inArray(liType, typeArray) !== -1 &&
                            //             price > valMin &&
                            //             price < valMax ) {
                            //             i++;
                            //             if (i == 1) { return false };
                            //         };
                            //     });
                            //     if (i == 0) {
                            //         if ($(this).hasClass('min-slider')) {
                            //             $('input.min-value').val(decMin).trigger('change');
                            //         } else if ($(this).hasClass('max-slider')){
                            //             $('input.max-value').val(decMax).trigger('change');
                            //         }
                            //         if (!$('.slider-hint').length) {
                            //             $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                            //             setTimeout(function() {
                            //                 $('.slider-hint').fadeOut(500).remove();
                            //             }, 3000);
                            //         };
                            //     };
                            // } else {
                            //     var products = $('.product-list');
                            //     var items = products.find('li:visible');
                            //     var i = 0;
                            //     items.each(function() {
                            //         var li = $(this);
                            //         var liType = li.data('type-id');
                            //         var price = li.data('price');
                            //         if ($.inArray(liType, typeArray) !== -1 &&
                            //             price > valMin &&
                            //             price < valMax ) {
                            //             i++;
                            //             if (i == 1) { return false };
                            //         };
                            //     });
                            //     if (i == 0) {
                            //         if ($(this).hasClass('min-slider')) {
                            //             $('input.min-value').val(decMin).trigger('change');
                            //         } else if ($(this).hasClass('max-slider')){
                            //             $('input.max-value').val(decMax).trigger('change');
                            //         }
                            //         if (!$('.slider-hint').length) {
                            //             $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                            //             setTimeout(function() {
                            //                 $('.slider-hint').fadeOut(500).remove();
                            //             }, 3000);
                            //         };
                            //     };
                            // };
                        });

                        $('.prices-text').on('change', 'input.min-value', function(event) {
                            var input = $(this);
                            var mainInput = $('.filter-slider-wrapper input.min');
                            var valMin = $('input.min-value').val();
                            var valMax = $('input.max-value').val();

                            if (collection && decoration) {
                                var products = $('.line-collection.t4[data-title-decoration="'+decoration+'"]');
                                var decMin = products.data('min-price');
                                var decMax = products.data('max-price');
                                var i = 0;
                                products.children('li').each(function() {
                                    var li = $(this);
                                    var liType = li.data('type-id');
                                    var price = li.data('price');
                                    if ($.inArray(liType, typeArray) !== -1 &&
                                        price > valMin &&
                                        price < valMax ) {
                                        i++;
                                        if (i == 1) { return false };
                                    };
                                });
                                if (i == 0) {
                                    if ($(this).hasClass('min-value')) {
                                        $('input.min-value').val(decMin).trigger('change');
                                    } else if ($(this).hasClass('max-value')){
                                        $('input.max-value').val(decMax).trigger('change');
                                    }
                                    if (!$('.slider-hint').length) {
                                        $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                                        setTimeout(function() {
                                            $('.slider-hint').fadeOut(500).remove();
                                        }, 3000);
                                    };
                                };
                            } else if (collection) {
                                var products = $('.line-collection.t2[data-title-collection="'+collection+'"]');
                                var decMin = products.data('min-price');
                                var decMax = products.data('max-price');
                                var items = products.find('li');
                                var i = 0;
                                items.each(function() {
                                    var li = $(this);
                                    var liType = li.data('type-id');
                                    var price = li.data('price');
                                    if ($.inArray(liType, typeArray) !== -1 &&
                                        price > valMin &&
                                        price < valMax ) {
                                        i++;
                                        if (i == 1) { return false };
                                    };
                                });
                                if (i == 0) {
                                    if ($(this).hasClass('min-value')) {
                                        $('input.min-value').val(decMin).trigger('change');
                                    } else if ($(this).hasClass('max-value')){
                                        $('input.max-value').val(decMax).trigger('change');
                                    }
                                    if (!$('.slider-hint').length) {
                                        $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                                        setTimeout(function() {
                                            $('.slider-hint').fadeOut(500).remove();
                                        }, 3000);
                                    };
                                };
                            // } else {
                            //     var products = $('.product-list');
                            //     var items = products.find('li:visible');
                            //     var i = 0;
                            //     items.each(function() {
                            //         var li = $(this);
                            //         var liType = li.data('type-id');
                            //         var price = li.data('price');
                            //         if ($.inArray(liType, typeArray) !== -1 &&
                            //             price > valMin &&
                            //             price < valMax ) {
                            //             i++;
                            //             if (i == 1) { return false };
                            //         };
                            //     });
                            //     if (i == 0) {
                            //         if ($(this).hasClass('min-value')) {
                            //             $('input.min-value').val(decMin).trigger('change');
                            //         } else if ($(this).hasClass('max-value')){
                            //             $('input.max-value').val(decMax).trigger('change');
                            //         }
                            //         if (!$('.slider-hint').length) {
                            //             $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                            //             setTimeout(function() {
                            //                 $('.slider-hint').fadeOut(500).remove();
                            //             }, 3000);
                            //         };
                            //     };
                            };
                            mainInput.val(input.val()).trigger('change');
                        });

                        $('.prices-text').on('change', 'input.max-value', function(event) {
                            var input = $(this);
                            var mainInput = $('.filter-slider-wrapper input.max');
                            var valMin = $('input.min-value').val();
                            var valMax = $('input.max-value').val();

                            if (collection && decoration) {
                                var products = $('.line-collection.t4[data-title-decoration="'+decoration+'"]');
                                var decMin = products.data('min-price');
                                var decMax = products.data('max-price');
                                var i = 0;
                                products.children('li').each(function() {
                                    var li = $(this);
                                    var liType = li.data('type-id');
                                    var price = li.data('price');
                                    if ($.inArray(liType, typeArray) !== -1 &&
                                        price > valMin &&
                                        price < valMax ) {
                                        i++;
                                        if (i == 1) { return false };
                                    };
                                });
                                if (i == 0) {
                                    if ($(this).hasClass('min-value')) {
                                        $('input.min-value').val(decMin).trigger('change');
                                    } else if ($(this).hasClass('max-value')){
                                        $('input.max-value').val(decMax).trigger('change');
                                    }
                                    if (!$('.slider-hint').length) {
                                        $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                                        setTimeout(function() {
                                            $('.slider-hint').fadeOut(500).remove();
                                        }, 3000);
                                    };
                                };
                            } else if (collection) {
                                var products = $('.line-collection.t2[data-title-collection="'+collection+'"]');
                                var decMin = products.data('min-price');
                                var decMax = products.data('max-price');
                                var items = products.find('li');
                                var i = 0;
                                items.each(function() {
                                    var li = $(this);
                                    var liType = li.data('type-id');
                                    var price = li.data('price');
                                    if ($.inArray(liType, typeArray) !== -1 &&
                                        price > valMin &&
                                        price < valMax ) {
                                        i++;
                                        if (i == 1) { return false };
                                    };
                                });
                                if (i == 0) {
                                    if ($(this).hasClass('min-value')) {
                                        $('input.min-value').val(decMin).trigger('change');
                                    } else if ($(this).hasClass('max-value')){
                                        $('input.max-value').val(decMax).trigger('change');
                                    }
                                    if (!$('.slider-hint').length) {
                                        $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                                        setTimeout(function() {
                                            $('.slider-hint').fadeOut(500).remove();
                                        }, 3000);
                                    };
                                };
                            // } else {
                            //     var products = $('.product-list');
                            //     var items = products.find('li:visible');
                            //     var i = 0;
                            //     items.each(function() {
                            //         var li = $(this);
                            //         var liType = li.data('type-id');
                            //         var price = li.data('price');
                            //         if ($.inArray(liType, typeArray) !== -1 &&
                            //             price > valMin &&
                            //             price < valMax ) {
                            //             i++;
                            //             if (i == 1) { return false };
                            //         };
                            //     });
                            //     if (i == 0) {
                            //         if ($(this).hasClass('min-value')) {
                            //             $('input.min-value').val(decMin).trigger('change');
                            //         } else if ($(this).hasClass('max-value')){
                            //             $('input.max-value').val(decMax).trigger('change');
                            //         }
                            //         if (!$('.slider-hint').length) {
                            //             $('.prices-text').append('<div class="slider-hint">Товаров не найдено</div>');
                            //             setTimeout(function() {
                            //                 $('.slider-hint').fadeOut(500).remove();
                            //             }, 3000);
                            //         };
                            //     };
                            };
                            mainInput.val(input.val()).trigger('change');
                        });
                        //Ввод цены, конец

                });
            </script>
            {/literal*}
        </div>
        {* <input name="отправить" value="отправить данные формы" style="" class="btn-sub-form" type="submit"> *}
        {* <a class="filters-reset" href="" style="display: none;">Сбросить фильтры</a> *}


{*         {foreach $filters as $fid => $filter}
            <div class="filter-param">
                {if $fid == 'price'}
                    {$c = $wa->shop->currency(true)}
                    <h5 class="collapsible {if strpos($filters_expand, 'price') !== false} expand{/if}" data-feature="price">
                        [`Price`]
                        <span class="hint">({$c.sign})</span>
                    </h5>
                    <div class="filter-content">
                        <div class="filter-slider-wrapper">
                            <input type="text" class="min" name="price_min" {if $wa->get('price_min')}value="{(int)$wa->get('price_min')}"{/if} placeholder="{floor($filter.min)}">
                            &mdash; <input type="text" class="max" name="price_max" {if $wa->get('price_max')}value="{(int)$wa->get('price_max')}"{/if} placeholder="{ceil($filter.max)}">
                        </div>
                    </div>
                {else}
                    <h5 class="collapsible{if strpos($filters_expand, $filter.code) !== false} expand{/if}" data-feature="{$filter.code}">
                        {$filter.name|escape}
                        {if isset($filter.min) && !empty($filter.unit)}<span class="hint">({$filter.unit.title})</span>{/if}
                        <span class="fiwex-feat" data-feat_id="{$filter.id}"></span>
                    </h5>
                    <div class="filter-content{if strpos($feature_button, $filter.code) !== false} feature-button{/if}">
                        {if $filter.type == 'boolean'}
                            <label><input type="radio" name="{$filter.code}"{if $wa->get($filter.code)} checked{/if} value="1">[`Yes`]</label>
                            <label><input type="radio" name="{$filter.code}"{if $wa->get($filter.code) === '0'} checked{/if} value="0">[`No`]</label>
                            <label><input type="radio" name="{$filter.code}"{if $wa->get($filter.code, '') === ''} checked{/if} value="">[`Any`]</label>
                        {elseif isset($filter.min)}
                            {$_v = $wa->get($filter.code)}
                            <div class="filter-slider-wrapper">
                                <input type="text" class="min" name="{$filter.code}[min]" placeholder="{$filter.min}" {if !empty($_v.min)}value="{$_v.min}"{/if}>
                                &mdash; <input type="text" class="max" name="{$filter.code}[max]" placeholder="{$filter.max}" {if !empty($_v.max)}value="{$_v.max}"{/if}>
                            {if !empty($filter.unit)}
                                {if $filter.unit.value != $filter.base_unit.value}<input type="hidden" name="{$filter.code}[unit]" value="{$filter.unit.value}">{/if}
                            {/if}
                            </div>
                        {else}
                            {foreach $filter.values as $v_id => $v}
                                <label{if strpos($feature_button, $filter.code) !== false} class="at-stylize-label"{/if}>
                                    <input{if strpos($feature_button, $filter.code) !== false} class="at-stylize-input"{/if} type="checkbox" name="{$filter.code}[]" {if in_array($v_id, (array)$wa->get($filter.code, array()))}checked{/if} value="{$v_id}">
                                    {if strpos($feature_button, $filter.code) !== false}
                                        {if $filter.type == 'color'}
                                            <span class="at-stylize-color" style="{$v->style}" title="{strip_tags($v)}"></span>
                                        {else}
                                            <span class="at-stylize-button">{$v}</span>
                                        {/if}
                                    {else}
                                        {$v}
                                        <span class="fiwex-feat-val" data-feat_val_id="{$v_id}" data-fiwex-parent_id="{$filter.id}"></span>
                                    {/if}
                                </label>
                            {/foreach}
                        {/if}
                    </div>
                {/if}
            </div>
        {/foreach}
        {if $wa->get('sort')}<input type="hidden" name="sort" value="{$wa->get('sort')|escape}">{/if}
        {if $wa->get('order')}<input type="hidden" name="order" value="{$wa->get('order')|escape}">{/if}
        {if !empty($filter_controls) || empty($theme_settings.ajax_filters)}
        <div class="filter-param controls">
            <input type="submit" value="[`Filter products`]"><a href="{$wa->currentUrl(0,1)}" id="clear-filters-expand" class="button third-type">[`Reset`]</a>
        </div>
        {/if} *}
    {* </form> *}
</div>

{/strip}